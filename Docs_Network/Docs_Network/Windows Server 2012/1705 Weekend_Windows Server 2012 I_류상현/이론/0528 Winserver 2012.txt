■ 권한(Permission)이란?
   * 권한은
     - 객체에 대한 접근을 허가하거나 거부하기 위해 사용되는 규칙이다.
     - 접근을 제어하기 위해서 사용된다

   * 권한을 부여하는 방법
     - 폴더나 프린터, 파일과 같은 자원에 허가 또는 거부 권한을 설정할 수 있다.
     - 로컬이나 도메인의 계정에 권한이 설정될 수 있다.
     - 권한은 직접적으로 부여하거나(명시적 권한) 상속받을 수도 있고(암시적 권한) 암시적인 권한설정을 이용할 수도 있다.

   * Windows / Linux의 권한상 차이점
     - Windows는 읽기 권한(읽기/실행 권한)을 주지 않으면, 실행도 되지 않음. Copy도 안됨.
       Linux는 읽기, 쓰기, 실행이 모두 각각 부여됨. Copy는 되는데 실행이 안되는 등의 권한부여가 가능.

■ 접근 제어 목록 (Access Control List)
   * 임의 접근 제어 목록 (DACL)
     - DACL은 자원에 접근이 허락되거나 거부되어있는 사용자와 그룹의 목록을 가지고 있다.
     - NTFS 볼륨의 모든 파일과 폴더는 DACL과 연관되어 있다.

   * 시스템 접근 제어 목록 (SACL)
     - SACL 자원 접근에 대한 감사를 제어한다.

   * 접근 제어 엔트리 (ACE)
     - DACL 또는 SACL의 항목을 정의한다.
     - DACL에 ACE가 명시되지 않았다면 해당 자원에 대한 접근은 거부된다.

기본적으로, 명시가 되어있지 않다면 거부, 명시가 되어있으면 허용

■ 권한 실습
   adds, dc설치 시점으로 돌아가서, cmd
	* SID 보는 방법
	  cmd >> "whoami" 입력시 Netbios 이름
		 "whoami /user" 입력시 SID도 함께 출력

   client100, 종료 후 HDD 2개 추가
	* 저장소 추가
	  10 GB HDD 2개 추가
		VM : SCSI 방식
		VB : SATA 방식

	  >> 정상 부팅 후 Win+E키 >> HDD는 무작정 장착한다고 해서 바로보이진 않음, 초기화 작업이 필요
	  >> win+R, "diskmgmt.msc" >> MBR로 설정 후 진행.
				      각각 E드라이브/NTFS와 F드라이브/FAT32로 설정 후 포맷.
	  >> E:\(NTFS)에서, 새폴더 만든 후, "속성", "보안" 탭 >> ACL과 ACE를 확인할 수 있음.
	  >> F:\(FAT32)에서, 새폴더를 만든 후, "속성"으로 들어가면 "보안" 탭이 있지 않은 것을 알 수 있음.
	  >> ACE는 NTFS에서만 지원하는 시스템임.

--------------------------------------------------------------------------------------------------------------------------------------------------------------
* NTFS  호환성이 떨어짐
        속도가 상대적으로 느림. (META정보가 많아서, FAT32에 비해 느림)
        4G 이상의 파일 저장 가능.
        보안성이 보강되어있음. (권한을 설정할 수 있음.)

* FAT32 속도가 빠르다. (META정보가 많지 않아서, 데이터 식별 속도가 빠름.)
        호환성이 좋다. (예전 파일 시스템의 대다수가 FAT32였으므로.)
        4G 이상의 파일을 저장할 수 없음. (FAT32를 만들 당시, 그런 파일을 사용할 일이 없었으므로, META정보보다 실제 파일크기가 더 커지게 되어서)
        보안성이 떨어짐. (권한을 설정할 수 없어서, 무조건 거부하거나, 무조건 허용하거나)

* ExFAT NTFS와 FAT모드의 장점을 모두 갖춤
        그러나, 파일시스템이 불안정하여, 장기간 보관하는 자료에 불리하다. (어느순간 문제가 발생하여 파일 날아감. >> 잠시 이동시키는 용도로는 좋음.)
--------------------------------------------------------------------------------------------------------------------------------------------------------------

계정에 대한 자세한 권한 부여를 위해, adds에서 user OU 안에 user1/user2/user3를 생성
client100에서, E:\안의 폴더의 보안 속성에서, 엔트리에 User1 : 모두 허용, User3 : 모두 거부로 설정한다.
user1 : 접근, 실행, 수정(및 저장) 가능 / user2 : 접근, 실행까지는 가능하나, 수정(및 저장)이 불가 / user3 : 접근 불가, 접근하려면 관리자 권한을 취득해야함.

client100에 administrator로 들어가서, 해당 폴더의 보안 속성의 ACE를 보면, "Users (CLIENT100\users)"가 있는 것을 볼 수 있음. (client100의 로컬 그룹 계정)
				      compmgmt.msc, "로컬 사용자 및 그룹", "그룹" >> Users의 속성에 "ITBANK\Domain Users"가 추가되어있음을 알 수 있음.
				      dsa.msc, "itbank.com" >> Users에서, Domain Users의 "속성", "구성원"에서, 각 User가 추가되어있음을 알 수 있음.
				      User3는 기본적인 허용이 적용되어있으나, 거부 설정도 함께 적용되어있음. (따라서, 허용과 거부가 동시에 설정되어있으면, 거부가 우선적으로 적용되는 것을 알 수 있음.)
보안 속성에서, ACE 아래에 기본권한을 대략적으로 설정할 수 있으며, 아래의 "고급", 명시된 계정의 "권한항목"(계정 더블클릭)을 들어가서, "고급 권한 표시" 항목을 클릭하면, 고급권한 목록을 볼 수 있음.
(특수권한(2008) / 고급권한(2012) : 기본적인 권한을 세분화 시켜둔 것.)

========================================================================================================================================================================================================
========================================================================================================================================================================================================
========================================================================================================================================================================================================

■ NTFS 권한 상속 (Inheritance)
   * 상속은 각각의 객체에 직접 권한을 부여하지 않고 자원에 대한 접근을 관리하기 위해 쓰인다.
   * 기본적으로 NTFS 권한은 부모 자식 관계에서 상속된다. (Default)

   * 상속 차단
     - 권한 상속은 차단될 수 있다.
     - 파일이나 폴더 레벨에서 차단이 이루어진다.
     - 폴더 레벨에서의 상속 차단은 자식 객체에 새로운 권한을 전파할 수 있게 해준다.

■ 상속 실습
client100, E:\에 "상속실습" 폴더를 만들고, User3에게 해당 폴더에 대한 수정권한을 부여한다.
해당 폴더 내부에 "Test1"을 생성한다. 생성시 E:\의 권한을 그대로 상속받는 것을 알 수 있음.
	* 회색 : 암시적 권한, 편집 불가
	* 검은색 : 명시적 권한, 편집 가능
	  (권한은 누적적용이 가능하다.)

E:\에서, "Test2.txt"를 생성, User2를 ACE에 추가 후, "권한실습" 폴더 내부로 이동.
명시적 권한이 그대로 유지되며, 상위 폴더의 권한 또한 그대로 상속받는 것을 알 수 있음.

E:\에서, Test3를 생성 후, 명시적 권한으로 user3을 추가한 후, "권한실습" 폴더 내부로 이동
>> Test1, Test3는 표면적으로는 같으나, 상속이 차단되었을 때, 차이점이 있음.

Test4에서, User3에 읽기/쓰기만 허용 후 "권한실습" 폴더로 이동. >> 암시적 권한으로 변경되었고, 설정에 따라 거부를 추가할 수 있음.
 * 암시적 권한이 우선되는 것을 알 수 있음.

 * "상속실습2" 폴더 생성 후, test1을 E:\에서 생성 후, 상속을 차단한다.
						      1. 상속된 사용 권한을 이 개체에 대한 명시적 사용 권한으로 변환합니다.
						      2. 이 개체에서 상속된 사용 권한을 모두 제거합니다.
						      >> 1은, 명시적 사용 권한으로 전환하여, 일부만 제한
						      >> 2는 모든 권한 차단.
						         (2 선택시, 해당 계정의 소유권을 제외한 모든 권한이 사라지는 것을 알 수 있음."상속실습2")
 * test2를 생성한 후, User3에게 기본 권한을 부여한 후, 상속을 차단한다.
   >> 명시적 권한(사용자가 직접 부여한 권한)은 상속 차단이 적용되지 않음.

 * 각 드라이브에도 기본적인 권한이 부여되어있음.(E:\의 속성 참고)

 * test3을 "상속실습2"에서 만든 직후, 모든 상속을 제거하면, 모든 권한이 제거되는 것을 알 수 있음. (소유자가 직접 상속을 제거했으므로)

1. C:\상속실습3 					2. E:\상속실습3
   >> User3, 수정 권한					   >> User3, 수정권한
   I. 드라이브에서 test1/test2 파일을 만든 후, 상속을 유지한 채 하나는 이동, 하나는 복사
   II. 드라이브에서, test3/test4 파일을 만든 후, 상속을 끊은 채 하나는 E:\로 이동, 하나는 E:\로 복사
	C:\ 							E:\
	유지 이동 : 가능, 액세스 가능				유지 이동 : 가능,
	유지 복사 : 가능, 액세스 가능				유지 복사 : 가능,
	차단 이동 : 불가, 액세스 거부				차단 이동 : 가능,
	차단 복사 : 불가  액세스 거부(원래는 이동만 불가)	차단 복사 : 가능,

다른 볼륨, 다른 드라이브로 이동할 때, 개체를 Copy하는 방식을 사용하므로, 상속이 유지됨.
 - 같은 드라이브상에서는, 경로값만 변경시키지만, 
 - 다른 드라이브 상에서는 Copy 및 원본에 대한 META정보 차단이 이루어짐.
	 * 파일과 폴더의 복사나 이동시 NTFS 권한 적용
	   - 파일과 폴더 복사 시 목적지 폴더에 권한 설정을 상속받는다.
	   - 같은 파티션으로의 파일 및 폴더 이동시 현재 권한 설정을 유지한다.
	   - 다른 파티션으로의 파일 및 폴더 이동시 목적지 폴더의 권한을 상속받는다.

========================================================================================================================================================================================================
========================================================================================================================================================================================================
========================================================================================================================================================================================================

■ 공유 폴더란? (Shared Folders)
   * 공유폴더는 폴더의 자원에 대한 네트워크 접근을 허락해놓은 폴더이다.
     - 폴더는 공유될 수 있지만 개별 파일들은 공유될 수 없다.
     - 기본적으로 폴더를 공유한 사용자는 해당 공유 폴더에 대해 모든 권한을 갖는다. (소유권)
     - 폴더의 공유 여부 확인
	>> 관리도구의 공유 및 저장소 관리 툴 (2008에서만 해당, 2012에서는 툴이 없어짐)
	>> 윈도우 익스플로러(컴퓨터)의 폴더 아이콘 변화
	>> 명령줄에서 Net Share 명령어 이용 (실습)
	>> 컴퓨터 관리자의 시스템 도구 (compmgmt.msc)

■ 공유폴더 실습
adds, C:\공유실습, User1에 기본권한으로 공유
win+R \\adds 또는 \\IP주소로 공유 폴더 접근 가능
user1 : 읽기는 가능하나, 쓰기가 권한상으로 불가 (복사까지는 가능)
user2 : 엔트리에 없으므로, 기본적으로 거부 설정되어있음.


고급공유에서, 공유 이름을 변경할 수 있음.
1. 공유 이름 변경시, 공유 폴더 목록에서 폴더의 이름이 변경되어 나타남.
2. 공유 이름을 [폴더명]$로 변경시, 공유 폴더 목록에 나타나지 않음.
   공유 이름을 "[폴더명]$"를 한 경우, "\\adds\[폴더명]$"를 접속시, 해당 폴더로 직접 연결됨
				      "\\adds\c$"로 접속시, 관리자 권한으로 C:\ 접속 가능

	* 관리 공유 폴더
	  - Hida a shared folder (숨은 공유)
	  - 공유 폴더 이름 뒤에 $가 포함되어 만들어지는 공유
	  - 숨김 공유는 보이지 않지만, 직접 연결은 가능함.
	  - \\server\secret$을 통해 연결 가능함.

	* Administrative Shared Folder (관리 공유)
	  - C$,D$와 같은 드라이브에 대한 관리 목적에 공유 (외장하드, USB, 광디스크 제외)
	  - admin$, %systemroot% (보통 C:\Windows)를 관리 목적으로 공유함.
	  - print$ 공유프린트를 만들 떄마다 시스템이 드라이버를 저장해두는 공유
	  - IPC$ 서버간 통신에 가장 많이 사용되는 공유. 다른 시스템에 이벤트 로그를 읽을 때 등과 같이 관리 목적으로 공유되는 경우, 드라이브를 매핑하지 않고 Named Pipes를 통해 읽는다.
	  - Repl$ 복제 서비스를 사용할 때마다 Repl$ 공유가 데이터를 전송하는 서버에 만들어진다.

adds, cmd
net user를 이용하여 계정 3개 생성
user1, P@ssw0rd1 / user2, P@ssw0rd2 /user3, P@ssw0rd3

client100,cmd
net user를 이용하여 계정 3개 생성
user1, P@ssw0rd / user2, P@ssw0rd /user3, P@ssw0rd3

adds, C:\ "공유실습1" 폴더, 샘플 폴더 생성, user1만 구성원에 추가 후 공유

client, \\adds를 통해 접속
user1 : 로그인, 접근 가능
user2 : 로그인 가능, 접근 불가

adds, C:\ "공유실습2" 폴더, 샘플 폴더 생성, user2만 구성원에 추가 후 공유
user2 : 로그인 가능, 공유폴더2 접근 가능
user3 : 로그인 절차 생략한 채 접속, 각 공유폴더 접근 불가
	>> Domain의 특성으로 인함.
	   SAM이나, NTDS.DIT가 함께 일치하여, 맞는 Data가 있으면, \\adds에 접근 가능.

■ CLI 방식으로 공유하기
   1) 폴더 생성 및 공유
      cd\
      md sharecli ("rmdir" in Lynx)
      dir /w ("ls" in Lynx, /w: 옆으로 펼쳐서)
      net share sharecli=c:\sharecli /grant:everyone,change(read,full)
      net share [폴더명]($)=[경로]   /grant:[사용자],[권한 : read, change, full 중 택1]
						             everyone을 한 후에, 각 계정에게 권한부여를 하는 것이 아니라,
							     각 계정에 대한 작업을 먼저 처리한 후, everyone을 처리
   2) 공유된 목록 확인
      net share
      net share sharecli

   3) 공유된 폴더 해제
      net share sharecli /delete

   4) 폴더 삭제
      rd sharecli /s /q (하위 파일이나 폴더가 있는 경우에도 묻지 않고 바로 삭제)
		  /s : 하위 경로를 포함한 모든 파일에 대해 명령 수행
		  이 경우, /s만 넣으면, 확인 질문이 발생하므로,
		  /q : 질의 없이
		  를 추가하여 질의를 생략한다.
		  단, /q는 /s가 있어야만 발생하며, /q만 단독 사용시 명령 수행이 되지 않음.

========================================================================================================================================================================================================
========================================================================================================================================================================================================
========================================================================================================================================================================================================

■ 정책
   * GPO (Group Policy Object) : 그룹 정책 개체
     - 도메인, OU에 적용할 정책과 설정 정보를 담고있는 일종의 컨테이너

   * 그룹정책
     - 관리자들이 사용자/컴퓨터 사용 권한을 중앙에서 제어할 수 있도록 관리 작업ㅇ르 단순화하는 규칙의 집합

	Permission		|  Right
	권한			|  권한
	Action On Object	|  Action On System

   * 그룹정책의 기능
     - 사용자/컴퓨터의 권한을 중앙에서 제어할 수 있도록 관리작업 단순화
     - Windows 구성 요소, 시스템 리소스, 네트워크 리소스, 제어판 유틸리티, 데스크톱, 시작메뉴
     - 사용자 내의 문서와 같은 특수 폴더에 대한 중앙집중화된 관리 디렉터리 생성
     - 지정된 시점(컴퓨터 부팅, 사용자 로그온)에 실행되는 사용자 및 컴퓨터 스크립트를 정의
     - 계정 잠금, 암호 감사, 사용자 권한 할당, 보안에 관련된 정책 구성
     - GPO는 적용될 사용자 지정 불가, 도메인 혹은 OU에 적용시킨다.

	로컬 그룹 정책		|	도메인 그룹 정책
	LGPO			|	GPO
	gpedit.msc(로컬)	|	gpmc.msc(도메인)
	독립실행형		|	도메인 컨트롤러
	정책 예외 불가		|	정책 적용시 분리, 예외처리 가능
	컴퓨터 구성		|	사용자 구성
	컴퓨터 기준 정책	|	사용자 계정 기준 정책
	로그인 계정 무관	|	로그온 컴퓨터 무관
	시스템 시작 시		|	로그온 시

   * 정책 적용 순서
     로컬 컴퓨터 정책 >> 도메인 그룹 정책 >> OU 그룹 정책
     gpedit.msc       >> gpmc.msc

   * 기본정책 (Default Domain Policy)
     - 도메인 전체를 위해 자동생성, 연결된 GPO
     - 기본 계정 정책을 구성

   * Default Domain Controllers Policy
     - DC를 위해 자동 생성, 연결된 GPO
     - 도메인 컨트롤러가 Domain Controllers OU에서 제거되지 않는 이상 도메인 내의 모든 컨트롤러에 적용
     - 사용자 권한이나 감사 정책 설정을 변경해야하는 도메인 컨트롤러에서 응용 프로그램을 설치할 경우 수정   

   * GPO 편집이 가능한 그룹
     - Domain Admins, Enterprise Admins, Group Policy, Creater Owner

   * GPO 생성, 연결
     - 기본적으로 그룹 정책 적용은 GPO를 도메인, OU에 연결하여 사용
     - 연결된 개체 없이 GPO만 단독으로 생성 가능하며, 그룹 정책 편집기의 생성된 GPO는 그룹정책개체 하위에 생성된다
     - 미리 생성된 GPO를 정책으로 적용할 대상에 불러와 연결해 사용
     - 적용 대상 개체에서 GPO를 생성하여 직접 연결해 사용
     - GPO와 개체의 연결을 삭제할 경우 GPO는 삭제되지 않음
     - GPO를 적용 받은 개체를 삭제해도 GPO는 삭제되지 않음
     - GPO를 삭제할 경우 연결된 모든 연결이 해제됨

   * 정책 상속
     - 정책은 상위 컨테이너에서 하위 컨테이너로 상속된다.
     - 상속은 거부하거나 강제 상속할 수 있다. 강제 상속이 우선순위가 높다
     - 강제 상속되는 GPO는 자물쇠 GPO아이콘이 Overlap됨
     - 상속을 거부하면 컨테이너의 아이콘에 파란색 느낌표 추가
     - 강제 상속은 상속 거부 불가

   * 스타터 GPO
     - 그룹 정책 개체에 대한 기본 템플릿
     - 자주 사용하는 정책들을 미리 구성하고 필요한 부분만 편집하여 추가 할때 사용
     - 관리 템플릿 영역의 정책에 대해서만 기본툴 구성
     - 컴퓨터의 구성의 관리템플릿, 사용자 구성의 관리템플릿만 구성

   * 계정정책
     - 암호정책, 계정잠금정책, Kerberos 정책 등은 도메인 루트와 연결되는 정책만 설정 가능
     - 기본 도메인 정책, 도메인이 연결되는 새로 만든 정책에서만 설정
     - 도메인 계정 정책은 해당 도메인의 모든 구성원 컴퓨터들의 기본 계정 정책이 됨
		
		도메인 적용 시기
		- 사용자 컴퓨터 시작/종료, 로그온/로그오프
		- DC : 5분에 한번씩 적용
		- member : Default 90분 (정책에서 수정가능, 현장에서는 보통 100분으로 해둠.(100이라는 숫자의 특성))
		- gpupdate /force : 정책 수동 적용

■ 정책 실습
"adds, DC설치 / client100, 멤버도메인 / client200, 초기설치" 복원

adds, dsa.msc
itbank.com
ㄴ경영지원 user1
ㄴ인사팀 user2
  총무팀 user3
  ㄴ지원파트 user4

client100, user4로 접속 >> 제어판 접근 가능 여부 확인

adds, cmd >> gpmc.msc >> 좌측 탭을 모두 전개
1. 좌측 탭 "포리스트: itbank.com", "도메인", "itbank.com", "그룹 정책 개체" 우클릭 >> "새로 만들기", 정책 이름 설정 후 생성
2. 생성된 GPO 우클릭하여 "편집", 편집기 실행 >> 편집기 좌측 탭 "사용자 구성", "정책", "관리 템플릿", "제어판"으로 접근
>> "Prohibit access to control panel and pc settings (제어판 및 PC 설정에 대한 액세스 금지)"를 먼저 설정한 후, "지정된 제어판 항목 숨기기" 등으로 제어
3. 정책 편집기 종료 후, 편집된 GPO를 도메인에 있는 각 컨테이너에 적용할 수 있음. (총무팀 OU에 이동시켜서 적용!)
4. Client100에서, 제어판이 접근 가능한지 확인 >> 접근이 가능함.
   cmd, "control.exe"로 제어판 접근이 가능한지 확인한다 >> 접근이 가능함.
        "gpupdate /force"로 gp 업데이트를 시행한다.
		------------------------------------------
		| 정책을 업데이트하는 중...		 |
		| 					 |
		| 컴퓨터 정책 업데이트가 완료되었습니다. |
		| 사용자 정책 업데이트가 완료되었습니다. |
		------------------------------------------
   업데이트가 완료된 후, 제어판에 접근할 수 없게 된 것을 알 수 있다. >> "제한 사항 : 이 작업은 시스템 제한 때문에 취소되었습니다. 시스템 관리자에게 문의하십시오."
								     >> (2008 등에서는 항목 자체가 사라짐!)
   * 권한은, 허용과 거부 중 거부가 우선적으로 적용되나,
     정책은, 그룹 정책 관리의 트리 구조 상에서 가장 가까운 정책이 우선적으로 적용됨.

client200에서, (WorkGroup으로 되어있음.)
cmd, gpedit.msc
컴퓨터 구성 >> 제어판 >> 제어판 설정이 없음.
사용자 구성 >> 제어판 >> 제어판 설정이 있음.




* 정책이 예외되는 2가지 경우.
  1. Administrator
     ex) 계정 잠금 인계값(Password가 5번 틀리면 1시간 동안 잠그는 등)의 경우,
         Administrator가 잠기면 답이 없으므로...
         대통령과 같음. (압수수색, 재판, 연행 등이 안되는거처럼)
  2. 안전모드

Linux에는 정책이 없음! Windows는 정책이 있음! >> 정책의 개략적인 그림을 볼 수 있어야함.
















시스템 종료 이벤트 추적기

