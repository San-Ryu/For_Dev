■ 다음 계정으로 실행 (Secondary Logon)이란?
* 사용자가 현재 로그온 한 사용자 권한이 아닌 다른 권한으로 응용 프로그램 실행시 사용
* 관리자 권한이 필요한 경우 관리자로 로그온 하는 것보다 
  "다음 계정으로 실행"을 이용하여 필요한 관리 권한으로 관리도구 실행하는 것이 보안상 더 안전하다.
  (보안상 안전하다 : 외부적 공격뿐만이 아니라, 내부적 침해에 대해서도 보안성이 확보하여야한다.)
* 관리자는 일반적인 작업시 일반 사용자 계정으로 사용하고 관리 작업이 필요한 경우 "다음 계정으로 실흥"을 이용해야한다.

■ 사용 방법
* GUI 환경 : 응용 프로그램 우 클릭 후 다음 계정으로 실행
             (관리자 권한으로 실행)
* CLI 환경 : Runas 명령어 이용

■ 실습
adds, DC 설치 / client100, 멤버도메인

adds, dsa.msc >> Users에 user1 만들고
client100에서 user1으로 로그인

시작 >> 관리도구 >> Active directory 사용자 및 컴퓨터 실행
user2 생성 시도 >> 다음 이유 때문에 user2 개체를 만들 수 없습니다. 액세스가 거부되었습니다.
dsa창 닫은 후, Active directory 사용자 및 컴퓨터 우클릭, 관리자 권한으로 실행
user2 생성 시도 >> 생성 가능
다시 닫은 후, Active directory 사용자 및 컴퓨터 일반 실행
user3 생성 시도 >> 다음 이유 때문에 user3 개체를 만들 수 없습니다. 액세스가 거부되었습니다.
(일회성이라는 것을 알 수 있음)




■ Runas 명령어 예제
* 로컬 보안 정책
  - Runas /user:itbank\administrator "mmc %windir%\system32\secpol.msc"


* 액티브 디렉터리
  - Runas /user:itbank\administrator "mmc %windir%\system32\dsa.msc
  - Runas /user:itbank\administrator "mmc dsa.msc" (환경변수 안에 "path" 명령어로 경로를 지정시켜두면 가능)

* 컴퓨터 관리
  - Runas /user:itbank\administrator "mmc %windir%\system32\compmgmt.msc

* 디스크 관리
  - Runas /user:itbank\administrator "mmc %windir%\system32\diskmgmt.msc

■ path 명령어
path 명령어 단독 사용으로, 현재 환경변수로서 지정된 경로를 알 수 있다.
위의 dsa.msc 등에 대해 다른 경로를 입력해주지 않아도 되는 이유.

C:\> path c:\ad
라는 형태로 명령어를 사용하면 기존 경로를 덮어씌워버림.
dsa.msc가 실행되지 않음을 알 수 있음.

C:\> path c:\ad;c:\windows\system32를 추가하면,
dsa.msc가 다시 됨을 알 수 있다.

■ 원격 데스크톱
* 원격 데스크톱
- 원격 서버 데스크톱에 접속 가능
- 동시 연결 수는 최대 2개
- 터미널 서버가 설치되어 있지 않아도 관리용으로 구성 가능
- 기본적으로 3389 포트 사용

* 원격 데스크톱의 장점
- 원격 접속을 통해 최대의 관리 작업 제공
- 여러 문제를 빠르게 진단 가능
- 인터넷 접속만 가능하면 어디서든 접근이 허용
- 원격지에서 GUI 환경에서 작업을 필요로 하는 경우

■ 원격 데스크톱 실습
1. 대상 PC의 전원이 켜져있어야 한다.
2. 인터넷이 연결되어있어야한다.

client100 
시작, "원격 데스크톱 연결" >> 172.16.0.1 
>> 다음 이유 중 하나로 인해 원격 데스크톱에서 원격 컴퓨터에 연결할 수 없습니다.
   1) 서버에 대한 원격 액세스가 활성화되어 있지 않습니다.
   2) 원격 컴퓨터가 꺼져 있습니다.
   3) 네트워크에 원격 컴퓨터가 없습니다.

   adds, system 속성으로 들어가서, 원격 데스크톱 설정 후,
   adds\administrator 계정을 원격 데스크톱 접속 가능하도록 추가시킨 후,
   client100, 원격 데스크톱 실행 >> 172.16.0.1(설정된 IP)으로 들어가서 
   접속하면, adds에서 



gpedit.msc >> 관리 템플릿, Windows 구성 요소, 터미널 서비스, 원격 데스크톱 세션 호스트, 연결
"원격 데스크톱 서비스 사용자를 하나의 원격 데스크톱 서비스 세션으로 제한" >> 사용 안함으로 동시 사용 가능
"연결 개수 제한" >> 무제한으로 제한하려면 "999999" 적용

서버 관리자 >> 역할 및 기능 추가 마법사
"원격 데스크톱 서비스", "원격 데스크톱 세션 호스트" 설치
>> 다시 시작

로그인시 기본적으로, administrator로 지정되어있던 계정이 기타 사용자로 되어있음을 알 수 있음.
다른 PC에서도 접근이 가능하다는 것을 알 수 있음.

■ 가정환경 예시


1. 포트포워딩 
NAT로 인해, 내부 사설 ip에 직접 연결할 수 없으므로,
예약되어있지 않은 빈 ip로 예약을 해야함.

cmd ipconfig /all 후, 게이트웨이(NAT Setting된 공유기 ip)를 통해 공유기에 접속,
포트포워딩 메뉴 선택 후, 192.168.0.( )를 통해 IP를 할당.
외부 포트와 내부 포트를 정해주면 됨 (18000~18000), (18000~18000) (쓰지 않는 통신 포트를 사용)
>> 공유기의 공인 IP를 입력한 후, 포트포워딩으로 확보된 IP를 통해 연결 가능
DDNS(유/무료)에서, MAC Address를 등록할 수 있음. MAC/ [Name].iptime.org 등으로 등록 됨.

PC가 꺼지면 NIC도 꺼지나, CMOS를 통해 WOL(Wake On LAN)을 사용하여 켤 수 있음. (Mother Board에서 지원되는 프로그램이어야 함.)
(약 9~15시간동안 전원 공급)
절전모드로 끄는 방법도 있음 (절전모드시, NIC 등에는 전원이 공급됨)

2. 공인 IP 사용
공인 IP를 사용하여, 모뎀에 직접 연결하고, 
방화벽을 설정한 후, 3389포트만 열어두면 됨.

3. 모뎀에 직접 접속
arp table을 통해 공유기 MAC Addr을 확보.
각 회사마다 특징이 있음. ex) SK의 경우, admin/admin______ (MAC Address 6자리)



■ 원격 지원
도움 요청 측에서 
win+R, "msra"를 통해 원격지원을 암호화 처리하기 위해, 도움 요청 파일과 암호를 받음.
(암호가 일치해야한다. (협상이 되야 연결이 됨))

"초대" 파일은 본래 메신져나 메일을 통해 전달해야함.
전달 후, 지원측에서 "초대"파일을 실행, 비밀번호 입력 후 대기 (대소문자 구분 안해도 됨)
이후, 요청 측에서 연결 허용하면, 원격지원 가능
연결 초기에는, 지원측은 바탕화면을 보기만 지원되며, 이후 제어권 요청 및 채팅 등 다양한 기능 수행 가능.

RemoteNet 등 원격서비스의 원리를 이용한 악성코드가 많음.





=====================================================================================================================================
====================================== 필기 예습 ====================================================================================
=====================================================================================================================================
■ 디스크 실습 준비
   adds만 사용, 초기설치로 복원, 저장소 열람
   >> 새 디스트 만들기, VDI, 동적할당, new1~new8 / 11 GB ~ 18 GB까지 총 8개 생성
   win+R, diskmgmt.msc 디스크 초기화를 시키지 않고, 생성된 모든 디스크를 오프라인으로 전환
   "win+E >> C드라이브", "Diskmgmt.msc", "cmd"창 모두가 한 눈에 들어오도록 만들어두고, 스냅샷 만듦 (디스크 관리).
   
■ SATA / IDE
   IDE, SATA는 초기화가되어 나오지 않는다.
   HDD 제조 회사에서 제조시, 환산 단위를 1000단위로 끊어버렸기 때문에, 항상 부족한 용량으로 표시됨.

■ 디스크 실습 (GUI)
디스크 1.
 "새 단순 볼륨"으로 볼륨 만듬 >> 4개를 만들면, 3개의 주 파티션이 만들어지고, 나머지 1개의 드라이브는 자동으로 논리 드라이브로 만들어짐.

디스크 2.
 우클릭하여 경로 설정(Mount)과 문자 할당 등이 가능함.
한번 할당된 문자는 변경 불가하며, 경로만 추가해줄 수 있다.

디스크 3. 
 GPT 방식으로 초기화
 >> 볼륨을 계속 추가해도, 주 파티션으로 계속 잡히는 것을 알 수 있음.

디스크 2.
 F드라이브를 삭제 후, 다시 설정하려고 하면, 1000에서 999로 크기가 줄어있음을 알 수 있음.
 (과거 파티션의 헤더부분으로 인한 감소) (CLI는 이렇게 못함.)

디스크 4, 5, 6, 7
모두 온라인 / MBR 초기화 / 동적 디스크로 변환
디스크 4에 1000MB짜리 볼륨 추가, 그 후 우클릭, "볼륨 확장" >> 1000만큼 추가
스팬, 스트라이프, 미러 볼륨을 각각 1000 Mb씩 추가하여 실습
일반 단순 볼륨도 다른 드라이브에 미러를 추가하여 미러볼륨으로 변환 가능
Raid-5, 동기화라는 개념이 나옴 (Parity Bit를 나열하는 작업)

모두 만든 후, 디스크 5의 연결을 해제해버린다.
단순, 스트라이프, 스팬 모두 "실패"로 복구하지 못하는 것을 볼 수 있음.
Raid-5, 미러는 복구 가능한 것을 볼 수 있음.

■ 디스크 실습 (CLI)
스냅샷을 통해, "디스크 관리" 시점으로 복구

list disk		-   디스크 조회
select disk 1		-   1 디스크 선택, list disk를 통해 선택된 디스크도 조회 가능
online disk		-   온라인으로 설정
attributes disk clear readonly - 디스크 읽기 속성 제거
create partition primary size=1000 - 파티션을 만듦
				   - 이를 4번 지속하면, 
select partition
delete partition
create partition extended
create partition logial size=1000
sel par 1
format quick
assign letter=e		-
format quick fs=fat32
assign letter=f
exi
cd /
mkdir 게임
diskpart
sel dis 1
sel par 3
format quick
assign mount=c:\게임		>> 디렉터리가 비어있지 않습니다 (오역)
				>> 한글이므로, 고쳐써야한다.
assign mount="c:\게임"
exi
cd /
mkdir music
diskpart
sel dis 1
sel par 4
format quick
assign mount="c:\게임"

----- 이와 별도로, Script 작성하는 방법이 있음.
메모장에,
(((((((((((((((((((((((((((((((
sel dis 2
online disk 
attributes disk clear readonly
cre par pri size=1000
format quick
assign letter=g
cre par pri size=1000
format quick
assign letter=h
cre par pri size=1000
format quick
assign letter=i
assign mount="c:\뮤직"
cre par pri size=1000
format quick
assign mount="c:\game"
))))))))))))))))))))))))))))))를 입력한 후,
diskpart /s c:\autodisk.txt
명령어로 스크립트 파일을 통해 실행하면 해당 스크립트를 통해 diskpart 작업 수행 가능

sel par 2
del par
cre par log size=1000
cre par pri size=1000

disk 1의 2, 4번째 파티션을 모두 삭제한 후 (확장 파티션까지) 다시 만들어보면,
cre par pri size=1000
후, 확인해보면 파티션 3의 뒤에 따라 붙는 것을 알 수 있음.

cre par pri size=1000 offset=1025024 (1000 Mb의 Kb 환산값)
을 이용하여, 딱 맞는 사이즈의 파티션을 만들면 1~3번째 파티션 사이에 꼭 맞게 생성할 수 있음.













■ 디스크 관리 도구
* 디스크 관리는 로컬 또는 원격의 디스크 정보를 보거나 디스크 관리를 수행하는 도구이다.

* 파티션과 볼륨 만들기 및 포맷, 드라이브 문자 할당과 같은 디스크 관련 작업을 수행할 수 있다,
  - Win+R, "diskmgmt.msc" (디스크 관리)
	   "compmgmt.msc" (컴퓨터 관리) >> 저장소 >> 디스크 관리

* CLI 환경에서의 디스크 관리는 diskpart 명령어를 이용
* Diskpart 명령을 사용하려면 먼저 포커스를 표시할 개체를 찾아서 선택한다
* 개체에 포커스가 있으면 입력한 모든 Diskpart 명령이 해당 개체에서 실행된다.
* 원격지 드라이브에 대해 좀 더 고급의 조작을 수행하기 위해 사용
* Diskpart는 반복적인 작업을 Script를 사용하여 관리할 수 있다.
  - Win+R "cmd" >> diskpart

■ 파티션이란? 
* 물리적 디스크를 분리해놓은 것을 파티션이라 한다.

* 파티션의 종류
  - 주 파티션 : 운영체제에 의해 잠재적으로 부팅 가능한 논리 드라이브라고 표시되어있는 하드디스크의 일부

  - 확장 파티션 : 논리 드라이브로 나눠질 수 있는 부팅이 가능하지 않은 부분
		  (4개까지 만들 수 있음.)
  - 논리 드라이브 : 단일 유닛으로 동작하는 하드디스크의 일부분 또는 파티션

* 주파티션은 분할할 수 없지만, 확장 파티션은 논리 드라이브로 분할 가능.
* 파티션은 볼륨으로 분류할 수 있으나, 볼륨은 파티션으로 분류할 수 없음.

■ MBR vs GPT
				MBR			GPT
부팅 가능 파티션 개수		4개			무제한 (Windows : 128개)
파티션당 최대 크기		2.2 TB			9.4 ZB
				(2.2*(10^12) Byte)	(9.4*(10^21) Byte)

* MBR 디스크에서는 주 파티션 4개 또는 주 파티션 3개, 확장 파티션 1개로 구성해야하지만,
  GPT에서는 확장파티션으로 구성팔 필요가 없다.

* MBR >> GPT 변경 방법
  - Select Disk >> Convert gpt

■ 파티션 생성 및 삭제
* 디스크 준비
  - List Disk (디스크 목록 확인)
  - Select Disk n (n=디스크 번호)
  - Online Disk (디스크를 온라인 상태로 변경)
  - Attribute Disk Clear Readonly (읽기 전용 속성 제거)

* 파티션 생성
  - Create partition primary size = 파티션 크기 (주 파티션)
  - Create partition extended size = 파티션 크기 (확장 파티션)
  - Create partition logical size = 파티션 크기 (논리 드라이브)

* 파티션 삭제
  - List Partition (파티션 목록 확인)
  - Select Partition n (n=파티션 번호)
  - Delete Partition 

■ 문자 할당
* 드라이브에 접근하기 위하여 사용
* 일반적으로 24개의 문자 할당 (최대 26개의 문자 할당)
  - 일반적으로 C~Z까지 할당
  - A와 B는 플로피 디스크 드라이브용으로 예약 (이제는 없으므로, 26개 모두 사용 가능)
  - 플로피 디스크 드라이브가 없다면 A와 B 할당 가능
* 시스템 볼륨이나 부팅 볼륨의 드라이브 문자는 바꿀 수 없다.
* 사용중인 문자 할당 불가능
* 문자 할당
  - List Partition (파티션 목록 확인)
  - Select Partition n (n=파티션 번호)
  - Assign lettet=G (파티션에 G 문자 할당)
* 문자 할당 제거
  - Select Partition n (n=파티션 번호)
  - Remove Letter = G (파티션에 할당된 G 문자 제거)

■ 드라이브 경로 할당 (Mount)
* 경로를 할당해주지 않으면 저장소를 사용할 수 없다.
* 드라이브 문자 대신 드라이브 경로 할당
* 문자 제한 없이 많은 드라이브에 액세스 할 수 있다.
* 기본 NTFS 볼륨이나 동적 NTFS 볼륨에 있는 빈 폴더에만 사용
* 드라이브 경로 할당 
  - C:\mount 폴더 생성
  - List partition (파티션 목록 확인)
  - select partition n (n=파티션 번호)
  - Assign mount = C:\mount
* 드라이브 경로 제거
  - Select partition n (n=파티션 번호)
  - Remove mount=C:\mount

■ 파티션 확장 및 축소
* Windows Server 2008에서는 주 파티션의 경우에도 볼륨 확장 및 축소 가능
* 확장은 디스크의 남은 공간만큼 확장 가능
* 축소는 사용중인 공간을 제외한 공간만큼 축소 가능
* 축소를 할 때 데이터 손실을 대비하여 백업하는 것이 좋다.
  - 파티션 우클릭 >> 볼륨 확장 / 축소

* 확장
  - Diskpart
  - List disk (디스크 목록 확인)
  - Select Disk n (n=디스크 번호)
  - List Partition (파티션 목록 확인)
  - Select Partition n (n=파티션 번호)
  - Extend Size = <크기>
* 축소
  - Select Partition (n=파티션 번호)
  - Shrink Querymax (축소 가능한 용량 확인)
  - Shrink Desired=<크기>

■ 포맷 및 파일 시스템 변경
* 디스크 포맷은 Windosw가 디스크에 정보를 저장할 수 있도로 ㄱ디스크를 파일 시스템으로 구성하는 것이다.
  - C:\>formal G:/fs:fat32
  - C:\>formal C:\mount /fs:fat32

* NTFS 파일 시스템은 이전 버전의 Windows에서 사용된 FAT 파일시스템보다 하드디스크 및 파일 또는 볼륨의 데이터에 대해 보다 나은 성능과 보안을 제공
* 이전 FAT16 또는 FAT32 파일 시스템을 NTFS로 변경 가능
* MTFS에서 FAT16 또는 FAT32로 변경 불가능
* 일부 이전 버전의 Windows에서는 로컬 NTFS 파티션의 데이터를 읽을 수 없다.
  - C:\>convert G:/fs:ntfs
  - C:\>convert C:\mount /fs:ntfs

============================================================================================================================
============================================================================================================================
============================================================================================================================

■ 동적 디스크
* 기본 디스크 vs 동적 디스크
* 동적 디스크 변환
* 단순 볼륨
* 볼륨 확장 및 축소
* 스팬 볼륨
* 스트라이프 볼륨 (Raid-0)
* 미러 볼륨 (Raid-1)
* Raid-5

■ 기본 디스크 vs 동적 디스크
		특징
기본 디스크	파티션으로 구분
		여러개의 물리적 디스크를 하나의 논리 디스크로 구성 불가
		4개의 주파티션 또는 3개의 주파티션, 1개의 확장 파티션으로 나눈다. (MBR)
		무제한으로 파티션 생성이 가능하지만, Windows에서는 128개의 주 파티션으로 제한된다. (GPT)
		디스크 오류 발생시 복구를 지원하지 않는다.
동적 디스크	파티션 대신 볼륨으로 구분
		여러 개의 물리적 디스크를 하나의 논리 디스크로 구성 가능
		볼륨 수에 제한이 없다.
		디스크에 오류 발생시 복구를 지원하는 디스크 구조를 만들 수 있다. (Raid-1, Raid-5)

■ 동적 디스크 변환
* 기본 디스크에서 동적 디스크로 변환시 데이터 손실 없이 변환 가능
* 모든 디스크를 변환할 수 있는 것은 아니다.
  - 이동식 디스크는 동적 디스크로 변환 불가
* 기본 디스크에 파티션은 단순 볼륨으로 변환된다
* 동적 디스크에서 기본 디스크로 되돌리기 위해서는 기존 볼륨을 모두 제거해야한다.
  - 디스크 구조와 데이터를 유지할 수 없다.

* 변환
  - List Disk (디스크 목록 확인)
  - Select Disk n (n=디스크 번호)
  - Convert Dynamic

■ 단순 볼륨
* 동적 디스크에서 사용 가능
* 하나의 디스크 공간을 나눈다
* 볼륨 수에 제한은 없다
* 확장 및 축소 가능
* 기본 디스크의 주 파티션과 같은 역할을 한다

* List Disk (디스크 목록 확인)
* Select Disk n (n=  디스크 번호)
* Create volume simple size = <크기>

■ 볼륨 확장 및 축소
* 주 파티션은 같은 디스크 공간에만 확장을 하였지만, 볼륨은 같은 디스크 공간 또는 다른 디스크 공간에 확장(스팬 볼륨) 가능
  - 볼륨 우 클릭 -> 볼륨 확장 및 축소

* 확장
  - Diskpart
  - List disk (디스크 목록 확인)
  - Select Disk n (n=디스크 번호)
  - Detail Disk (디스크 정보, 디스크에 생성된 볼륨 확인)
  - Select Volume n (n=파티션 번호)
  - Extend Size = <크기>
* 축소
  - Select Partition (n=파티션 번호)
  - Shrink Querymax (축소 가능한 용량 확인)
  - Shrink Desired=<크기>

■ 스팬 볼륨 (직렬 연결, 볼륨 당 하나의 버퍼를 제공받을 수 있음. 버퍼 개수는 1개.)
* 동적 디스크 2개 이상 최대 32개까지 생성 가능
* 내결함성을 갖지 않는다.
  (
* 시스템 볼륨이나 부팅 볼륨이면 스팬 볼륨을 구성하지 못한다.
* 확장 및 축소 가능

* List Disk (디스크 목록 확인)
* Select Disk n (n=디스크 번호)
* Create Volume Simple Size=<Size>
* Extend Size = <Size> Disk=n (n=Disk 번호)

■ 스트라이프 볼륨 (Raid-0) (병렬 연결, 디스크당 버퍼를 제공받을 수 있음. 가능한 버퍼 개수당 속도가 향상, 속도는 디스크 기능이 낮은 디스크의 속도 맞춤.)
* 동적 디스크 2개 이상 최대 32개까지 생성 가능
* Windows에서 사용할 수 있는 모든 볼륨의 최적 성능 제공
* 내결함성을 갖지 않는다
  (다수의 물리적 디스크를 논리적으로 묶어서 사용을 하게 되는데, 
   디스크 1개라도 고장이 나게 되면, 해당 볼륨 전체의 데이터를 사용 및 복구할 수 없다.)
* 확장 및 축소 불가능

* List Disk (디스크 목록 확인)
* Select Disk n (n=디스크 번호)
* Create Volume Stripe Size=<Size> disk=n,n,n...

■ 미러 볼륨 (Raid-1)
* 동적 디스크 2개 필요 (디스크 비용이 2배로 듦, 하드디스크 활용률이 50%로 떨어짐)
* 기존의 단순 볼륨을 미러링한다
* 동일한 복사본 두 개를 만들어 중복성 제공 (내결함성)
* 확장 및 축소 불가능

* List Disk (디스크 목록 확인)
* Select Disk n (n=디스크 번호)
* Detail Disk (디스크 정보, 디스크에 생성된 볼륨 확인)
* Select Volume n (n=볼륨 번호)
* Add Disk n (n=디스크 번호)

* 미러볼륨 (Raid-1) 복구 방법
  - 볼륨 우클릭 >> 미러 제거 >> 없는 디스크 선택
    (미러를 제거하면 단순 볼륨으로 남으며, 데이터 손실 없이 사용 가능하다.

■ Raid-5
* 동적 디스크 3개 이상 32개 이하 필요
* 추가 디스크 하나의 비용만으로 내결함성 제공 (N개 중 N-1개를 사용)
* 오류 검사를 위하여 Parity Bit를 사용        (1개는 짝수 Parity Bit값 저장)
* 확장 및 축소 불가능

* List Disk (디스크 목록 확인)
* Select Disk n (n=디스크 번호)
* Create Volume Raid Size=<Size> Disk=n,n,n...

■ Raid-6 (Linux에서만 사용)
* 0+1, Raid-12 등 하드웨어적 지원 필요한 방식도 있음.

24 Drive / Strife Volume (Raid-0) / Over 2GB A Second / 


=====================================================================================================================================
====================================== 필기 예습 ====================================================================================
=====================================================================================================================================
































